# Hasing

인증을 알아보기 전에

암호화에 기본인 Hashing 에 대해 알아보자 <br/><br/>

예시 1)
인증과정을 거치지 않고 이메일과 관련된 정보를 얻고 싶을 때 그림과 같은 설계를 할 수 있다

클라이언트

이메일과 관련된 정보 요청

서버

이메일과 관련된 정보를 DB에서 가져와서 응답

이렇게 만들면 보안상 이슈가 발견될 수 있다

누구라도 이메일 정보만 알고 있으면 모든 정보에 접근 할 수 있다

<br/>

예시 2) 
비밀번호를 추가해서 설계를 해보자

클라이언트

데이터 요청시 이메일과 비밀번호를 같이 요청

서버

클라이언트에서 요청을 받고 DB에서 이메일, 비밀번호를 받아서 2개를 비교

비교해서 맞으면 관련된 정보를 DB에서 받아서 응답

하지만 비밀번호는 이메일과 다르게 보안이 필요하다

예를 들어 비밀번호를 해킹당하면 유사한 비밀번호를 가진 사이트가 거진 해킹당한다

비밀번호를 데이터베이스에 암호화해서 저장하면 보안을 강화할 수 있다

<br/>


### Encryption (암호화)

일련의 정보를 임의의 방식을 사용하여 다른 형태로 변환한다

해당 방식을 소유한 사람을 제외하고 이해할 수 없도록 ‘알고리즘'을 이용해 정보를 관리하는 과정

예시) 간단한 알고리즘 암호화

실제로는 엄청 오래걸리는 시간복잡도를 가지고 있는 알고리즘으로 암호화를 한다

```jsx
// 2번째 인자만큼 위치가 오른쪽으로 이동하는 알파벳

shiftBy('jihye', 2) // 'lkjag'
shiftBy('lkjag', -2) // 'jihye'

const shiftBy = function(content, offset){
	return content.split('').map(function(letter){
		return String.fromCharCode(letter.charCodeAt() + offset);
	}).join('');
}
```

<br/>

예시 3) 암호화 알고리즘 사용

클라이언트

이메일 + 비밀번호 전달하면서 요청

서버

요청 받은 비밀번호를 서버측에서 암호화해서 DB와 대조

DB

알고리즘을 통해서 비밀번호를 암호화해서 문자열로 저장해둔다

정보가 해킹을 당해도 알고리즘을 모르기에 정보를 알 수 없다

<br/>

### Hashing

어떠한 문자열에 ‘임의의 연산'을 적용하며 다른 문자열로 변환하는 것

주의사항

1. 모든 값에 대해 해시 값을 계산하는데 오래걸리지 않아야 한다 / 시간이 너무 걸리면 사용자가 떠나감
2. 최대한 해시 값을 피해야 하며, 모든 값은 고유한 해시 값을 가진다 
3. 아주 작은 단위의 변경이라도 완전히 다른 해시 값을 가져야 한다.

 <br/>

대표적인 해시 알고리즘

SHA1

SHA256 (최신)

<br/>

예시 4) 외부에서 만들어진 알고리즘으로 해시 진행

DB

해시 된 값으로 데이터 베이스에 저장

<br/>

### Salt

암호화해야 하는 값에 어떤 ‘별도의 값'을 추가하여 결과를 변형하는 것

1. 암호화만 해놓는다면 해시된 결과과 늘 동일

해시된 값과 원래 값을 테이블(레인보우 테이블)로 만들서어 decoding 해버리는 경우도 생긴다

2. 원본값에 임의로 약속된 ‘별도의 문자열'을 추가하여 해시를 진행한다면 

기존 해시값과 전혀 다른 해시값이 반환되어 알고리즘이 노출되더라도 원본값을 보호할 수 있도록 하는 안전 장치

3. Salt

기존: 암호화 하려는 값 >>> hash 값

Salt: 암호화 하려는 값 + Salt 용 값  >>> hash 값

<br/>

사용시 주의점

유저와 패스워드 별로 유일한 값을 가져야 한다

사용자 계정을 생성할 때와 비밀번호를 변경할 때마다 새로운 임의의 Salt 를 사용해서 해싱해야 한다

절대 재사용하지 말아야한다

DB의 유저 테이블에 같이 저장되어야 한다

<br/>

예시 5) Salt 사용

서버

요청 받은 비밀번호를 암호화(해싱) + Salt 한 다음에 비교

<br/>

### Quiz 정리

클라이언트에서 HTTPS 를 이용해서 비밀번호가 중간에 탈취되지 않도록 주의하고

서버는 요청으로 받은 비밀번호를 암호화(해싱)해서 DB에 저장한다

Salt는 암호화해야 하는 값에 별도의 값을 추가하여 결과를 변형하는 것

SSL은 HTTPS에서 사용하는 보안 기능이다

레인보우 테이블은 특정 입력값을 해싱한 결과를 대량으로 모아놓은 표

이를 대비하기 위해선 개발자만이 아는 Salt를 추가해서 해싱한 값이 달라지도록 해야한다